<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HCyph</title>    
  <link rel="stylesheet" href="main.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat&family=Open+Sans&family=PT+Sans&family=Parisienne&family=Playfair+Display&family=Taviraj:wght@200&family=Ubuntu+Condensed&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/c16d9d560c.js" crossorigin="anonymous"></script>
</head>
<body class="dark-mode">

  <div id="content" style="display:none;">
    <h1>Welcome!</h1>
    <p>This content is password protected.</p>
    <br>
    <div id="cipher-tool">
      <p style="color:#ccc; font-size:0.9rem;">For decryption, enter the same shift type and any custom/person info used when encrypting.</p>

      <label id="textLabel" for="plainText">Enter text to encrypt:</label>
      <input type="text" id="plainText" placeholder="Type here...">

      <label for="shiftType">Choose shift type:</label>
      <select id="shiftType">
        <option value="daily">Daily Shift</option>
        <option value="custom">Custom Shift</option>
        <option value="person">Person-Based Shift</option>
      </select>

      <div id="customShiftContainer" style="display:none; margin-top:0.5rem;">
        <label for="customShift">Enter custom shift:</label>
        <input type="number" id="customShift" placeholder="e.g., 5">
      </div>

      <div id="personShiftContainer" style="display:none; margin-top:0.5rem;">
        <label for="personName">Enter person's name:</label>
        <input type="text" id="personName" placeholder="e.g., Alice">
      </div>

      <button onclick="encryptText()">Encrypt</button>
      <button onclick="decryptText()">Decrypt</button>
      <p><strong>Result:</strong> <span id="cipherResult"></span></p>
      <button id="copyButton" style="display:none;">Copy</button>
    </div>           
  </div>
      
  <div id="password-form">
    <h1>Welcome to HCyph.</h1>
    <h3>Please Enter Your Six Digit Pin to Continue</h3>
    <br>
    <label for="password">PIN:</label>
    <input type="password" id="password" name="password">
    <button onclick="checkPassword()">Enter</button>
    <p id="error-message" style="color: red; display: none;">Incorrect password. Please try again.</p>
  </div>
  
  <script>
    // SHA-256 helper
    async function hashString(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);
      const hashBuffer = await crypto.subtle.digest("SHA-256", data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, "0")).join("");
    }

    const correctHash = "db26f1fbe486df25b87b9b3ce8c81d35a1dad5ca7040af8423a3859270961b51";

    async function checkPassword() {
      const passwordInput = document.getElementById("password");
      const errorMessage = document.getElementById("error-message");
      const content = document.getElementById("content");
      const passwordForm = document.getElementById("password-form");

      const enteredHash = await hashString(passwordInput.value);

      if (enteredHash === correctHash) {
        content.style.display = "block";
        passwordForm.style.display = "none";
        errorMessage.style.display = "none";
      } else {
        errorMessage.style.display = "block";
        passwordInput.value = "";
      }
    }

    function caesarCipher(str, shift) {
      return str.split('').map(char => {
        if (char.match(/[a-z]/i)) {
          const base = char === char.toUpperCase() ? 65 : 97;
          return String.fromCharCode(((char.charCodeAt(0) - base + shift + 26) % 26) + base);
        } else {
          return char;
        }
      }).join('');
    }

    const substitutionMap = {
      q: '1', w: '2', e: '3', r: '4', t: '5',
      y: '6', u: '7', i: '8', o: '9', p: '0',
      a: '-', s: '/', d: ':', f: ';', g: '(', h: ')',
      j: '$', k: '&', l: '@', z: '"', x: '.', c: ',', v: '?',
      b: '!', n: "'", m: '['
    };

    const reverseSubstitutionMap = Object.fromEntries(
      Object.entries(substitutionMap).map(([k, v]) => [v, k])
    );

    function applyCustomSubstitution(str) {
      return str.split('').map(char => {
        const lowerChar = char.toLowerCase();
        return substitutionMap[lowerChar] !== undefined ? substitutionMap[lowerChar] : char;
      }).join('');
    }

    function getShift() {
      const shiftType = document.getElementById("shiftType").value;
      
      if (shiftType === "daily") {
        return new Date().getDate();
      } else if (shiftType === "custom") {
        const customShift = parseInt(document.getElementById("customShift").value, 10);
        return isNaN(customShift) ? 0 : customShift;
      } else if (shiftType === "person") {
        const name = document.getElementById("personName").value.toLowerCase() || "";
        return Array.from(name).reduce((sum, c) => sum + c.charCodeAt(0), 0) % 26;
      }
      return 0;
    }

    function encryptText() {
      const input = document.getElementById("plainText").value;
      const shift = getShift();
      const caesar = caesarCipher(input, shift);
      const encrypted = applyCustomSubstitution(caesar);

      const cipherResult = document.getElementById("cipherResult");
      cipherResult.textContent = encrypted;
      document.getElementById("copyButton").style.display = "inline-block";

      document.getElementById("textLabel").textContent = "Enter text to encrypt:";
    }

    function decryptText() {
      const input = document.getElementById("plainText").value;
      const shift = getShift(); // always use user input for decryption

      const reversedSub = input.split('').map(char => {
        return reverseSubstitutionMap[char] !== undefined ? reverseSubstitutionMap[char] : char;
      }).join('');

      const decrypted = reversedSub.split('').map(char => {
        if (char.match(/[a-z]/i)) {
          const base = char === char.toUpperCase() ? 65 : 97;
          return String.fromCharCode(((char.charCodeAt(0) - base - shift + 26) % 26) + base);
        } else {
          return char;
        }
      }).join('');

      const cipherResult = document.getElementById("cipherResult");
      cipherResult.textContent = decrypted;
      document.getElementById("copyButton").style.display = "inline-block";

      document.getElementById("textLabel").textContent = "Enter text to decrypt:";
    }

    // Show/hide custom input fields
    document.getElementById("shiftType").addEventListener("change", function() {
      const type = this.value;
      document.getElementById("customShiftContainer").style.display = (type === "custom") ? "block" : "none";
      document.getElementById("personShiftContainer").style.display = (type === "person") ? "block" : "none";
    });

    // Clipboard copy
    document.getElementById("copyButton").addEventListener("click", function() {
      const text = document.getElementById("cipherResult").textContent;
      navigator.clipboard.writeText(text)
        .then(() => alert("Copied to clipboard!"))
        .catch(err => console.error("Error copying text: ", err));
    });
  </script>
</body>
</html>
